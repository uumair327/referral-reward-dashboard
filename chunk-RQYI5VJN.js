import{Z as y,ba as O,g as C,k as o,o as d}from"./chunk-5LZ43AQJ.js";import{a as f,b as l}from"./chunk-7CGTOI24.js";var m=[{id:"demat-account",name:"Demat Account",icon:"account_balance",description:"Stock trading and investment account referrals",isActive:!0,displayOrder:1},{id:"medical-app",name:"Medical App",icon:"medical_services",description:"Healthcare and medical service applications",isActive:!0,displayOrder:2},{id:"hospitality-hotel",name:"Hospitality & Hotel",icon:"hotel",description:"Hotel bookings and hospitality services",isActive:!0,displayOrder:3},{id:"entertainment",name:"Entertainment",icon:"movie",description:"Streaming services and entertainment platforms",isActive:!0,displayOrder:4},{id:"online-products",name:"Online Products",icon:"shopping_cart",description:"E-commerce platforms like Amazon, Flipkart",isActive:!0,displayOrder:5}];var v=class{static validateReferralOffer(e){let r=[];return!e.title||e.title.trim().length===0?r.push({field:"title",message:"Title is required"}):e.title.length>100&&r.push({field:"title",message:"Title must be less than 100 characters"}),!e.description||e.description.trim().length===0?r.push({field:"description",message:"Description is required"}):e.description.length>1e3&&r.push({field:"description",message:"Description must be less than 1000 characters"}),!e.referralLink||e.referralLink.trim().length===0?r.push({field:"referralLink",message:"Referral link is required"}):this.isValidUrl(e.referralLink)||r.push({field:"referralLink",message:"Please enter a valid URL"}),(!e.categoryId||e.categoryId.trim().length===0)&&r.push({field:"categoryId",message:"Category is required"}),e.referralCode&&e.referralCode.length>50&&r.push({field:"referralCode",message:"Referral code must be less than 50 characters"}),{isValid:r.length===0,errors:r}}static validateCreateReferralOfferRequest(e){return this.validateReferralOffer(e)}static validateCategory(e){let r=[];return!e.name||e.name.trim().length===0?r.push({field:"name",message:"Category name is required"}):e.name.length>50&&r.push({field:"name",message:"Category name must be less than 50 characters"}),(!e.icon||e.icon.trim().length===0)&&r.push({field:"icon",message:"Category icon is required"}),!e.description||e.description.trim().length===0?r.push({field:"description",message:"Category description is required"}):e.description.length>200&&r.push({field:"description",message:"Category description must be less than 200 characters"}),e.displayOrder!==void 0&&(e.displayOrder<0||e.displayOrder>100)&&r.push({field:"displayOrder",message:"Display order must be between 0 and 100"}),{isValid:r.length===0,errors:r}}static validateCreateCategoryRequest(e){return this.validateCategory(e)}static isValidUrl(e){try{let r=new URL(e);return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}}static isValidReferralCode(e){return!e||e.trim().length===0?!0:/^[a-zA-Z0-9_-]+$/.test(e)&&e.length<=50}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static sanitizeHtml(e){return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"")}static validateRequiredFields(e,r){let t=[];return r.forEach(s=>{let i=e[s];(i==null||typeof i=="string"&&i.trim().length===0)&&t.push({field:String(s),message:`${String(s)} is required`})}),t}};var h=class p{STORAGE_KEY="referral_categories";categoriesSubject=new C([]);categories$=this.categoriesSubject.asObservable();constructor(){this.loadCategories()}loadCategories(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let r=JSON.parse(e);this.categoriesSubject.next(r)}else{let r=m.map(t=>l(f({},t),{offerCount:0}));this.saveCategories(r),this.categoriesSubject.next(r)}}catch(e){console.error("Error loading categories:",e);let r=m.map(t=>l(f({},t),{offerCount:0}));this.categoriesSubject.next(r)}}saveCategories(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.categoriesSubject.next(e)}catch(r){console.error("Error saving categories:",r)}}getAllCategories(){return this.categories$}getActiveCategories(){return this.categories$.pipe(d(e=>e.filter(r=>r.isActive)))}getCategories(e){return this.categories$.pipe(d(r=>{let t=[...r];if(e.isActive!==void 0&&(t=t.filter(a=>a.isActive===e.isActive)),e.searchTerm){let a=e.searchTerm.toLowerCase();t=t.filter(c=>c.name.toLowerCase().includes(a)||c.description.toLowerCase().includes(a))}e.sortBy?t.sort((a,c)=>{let u=a[e.sortBy],g=c[e.sortBy];return u==null&&g==null?0:u==null?1:g==null?-1:u<g?e.sortDirection==="desc"?1:-1:u>g?e.sortDirection==="desc"?-1:1:0}):t.sort((a,c)=>a.displayOrder-c.displayOrder);let s=(e.page-1)*e.limit,i=s+e.limit;return{data:t.slice(s,i),total:t.length,page:e.page,limit:e.limit,totalPages:Math.ceil(t.length/e.limit)}}))}getCategoryById(e){return this.categories$.pipe(d(r=>r.find(t=>t.id===e)))}createCategory(e){try{let r=this.categoriesSubject.value;if(r.find(n=>n.name.toLowerCase()===e.name?.toLowerCase()))return o({success:!1,error:"Category with this name already exists"});let s={id:this.generateId(),name:e.name,icon:e.icon,description:e.description,isActive:!0,offerCount:0,displayOrder:e.displayOrder??r.length+1},i=[...r,s];return this.saveCategories(i),o({success:!0,data:s,message:"Category created successfully"})}catch{return o({success:!1,error:"Failed to create category"})}}updateCategory(e){try{let r=this.categoriesSubject.value,t=r.findIndex(n=>n.id===e.id);if(t===-1)return o({success:!1,error:"Category not found"});if(e.name&&r.find(a=>a.id!==e.id&&a.name.toLowerCase()===e.name?.toLowerCase()))return o({success:!1,error:"Category with this name already exists"});let s=l(f(f({},r[t]),e),{id:e.id}),i=[...r];return i[t]=s,this.saveCategories(i),o({success:!0,data:s,message:"Category updated successfully"})}catch{return o({success:!1,error:"Failed to update category"})}}deleteCategory(e){try{let r=this.categoriesSubject.value,t=r.find(i=>i.id===e);if(!t)return o({success:!1,error:"Category not found"});if(t.offerCount>0)return o({success:!1,error:"Cannot delete category with existing offers"});let s=r.filter(i=>i.id!==e);return this.saveCategories(s),o({success:!0,message:"Category deleted successfully"})}catch{return o({success:!1,error:"Failed to delete category"})}}updateOfferCount(e,r){let t=this.categoriesSubject.value,s=t.findIndex(i=>i.id===e);if(s!==-1){let i=[...t];i[s]=l(f({},i[s]),{offerCount:Math.max(0,r)}),this.saveCategories(i)}}getCategoryStats(){return this.categories$.pipe(d(e=>({totalCategories:e.length,activeCategories:e.filter(r=>r.isActive).length,totalOffers:e.reduce((r,t)=>r+t.offerCount,0)})))}resetToDefaults(){try{let e=m.map(r=>l(f({},r),{offerCount:0}));return this.saveCategories(e),o({success:!0,data:e,message:"Categories reset to defaults"})}catch{return o({success:!1,error:"Failed to reset categories"})}}generateId(){return"cat_"+Date.now().toString(36)+Math.random().toString(36).substr(2)}static \u0275fac=function(r){return new(r||p)};static \u0275prov=y({token:p,factory:p.\u0275fac,providedIn:"root"})};var b=class p{constructor(e){this.categoryService=e;this.loadOffers()}STORAGE_KEY="referral_offers";offersSubject=new C([]);offers$=this.offersSubject.asObservable();loadOffers(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e).map(s=>l(f({},s),{createdAt:new Date(s.createdAt),updatedAt:new Date(s.updatedAt)}));this.offersSubject.next(t)}else this.offersSubject.next([])}catch(e){console.error("Error loading offers:",e),this.offersSubject.next([])}}saveOffers(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.offersSubject.next(e),this.updateCategoryCounts(e)}catch(r){console.error("Error saving offers:",r)}}updateCategoryCounts(e){let r=new Map;e.forEach(t=>{if(t.isActive){let s=r.get(t.categoryId)||0;r.set(t.categoryId,s+1)}}),this.categoryService.getAllCategories().subscribe(t=>{t.forEach(s=>{let i=r.get(s.id)||0;this.categoryService.updateOfferCount(s.id,i)})})}getAllOffers(){return this.offers$}getActiveOffers(){return this.offers$.pipe(d(e=>e.filter(r=>r.isActive)))}getOffers(e){return this.offers$.pipe(d(r=>{let t=[...r];if(e.categoryId&&(t=t.filter(a=>a.categoryId===e.categoryId)),e.isActive!==void 0&&(t=t.filter(a=>a.isActive===e.isActive)),e.searchTerm){let a=e.searchTerm.toLowerCase();t=t.filter(c=>c.title.toLowerCase().includes(a)||c.description.toLowerCase().includes(a)||c.referralCode&&c.referralCode.toLowerCase().includes(a))}e.sortBy?t.sort((a,c)=>{let u=a[e.sortBy],g=c[e.sortBy];return u==null&&g==null?0:u==null?1:g==null?-1:u<g?e.sortDirection==="desc"?1:-1:u>g?e.sortDirection==="desc"?-1:1:0}):t.sort((a,c)=>c.updatedAt.getTime()-a.updatedAt.getTime());let s=(e.page-1)*e.limit,i=s+e.limit;return{data:t.slice(s,i),total:t.length,page:e.page,limit:e.limit,totalPages:Math.ceil(t.length/e.limit)}}))}getOffersByCategory(e){return this.offers$.pipe(d(r=>r.filter(t=>t.categoryId===e&&t.isActive)))}getOfferById(e){return this.offers$.pipe(d(r=>r.find(t=>t.id===e)))}createOffer(e){try{let r=this.offersSubject.value;if(e.referralCode&&r.find(n=>n.categoryId===e.categoryId&&n.referralCode===e.referralCode))return o({success:!1,error:"Referral code already exists in this category"});let t={id:this.generateId(),title:e.title,description:e.description,referralLink:e.referralLink,referralCode:e.referralCode,categoryId:e.categoryId,isActive:!0,createdAt:new Date,updatedAt:new Date,clickCount:0},s=[...r,t];return this.saveOffers(s),o({success:!0,data:t,message:"Offer created successfully"})}catch{return o({success:!1,error:"Failed to create offer"})}}updateOffer(e){try{let r=this.offersSubject.value,t=r.findIndex(n=>n.id===e.id);if(t===-1)return o({success:!1,error:"Offer not found"});if(e.referralCode&&r.find(a=>a.id!==e.id&&a.categoryId===(e.categoryId||r[t].categoryId)&&a.referralCode===e.referralCode))return o({success:!1,error:"Referral code already exists in this category"});let s=l(f(f({},r[t]),e),{id:e.id,updatedAt:new Date}),i=[...r];return i[t]=s,this.saveOffers(i),o({success:!0,data:s,message:"Offer updated successfully"})}catch{return o({success:!1,error:"Failed to update offer"})}}deleteOffer(e){try{let r=this.offersSubject.value;if(!r.some(i=>i.id===e))return o({success:!1,error:"Offer not found"});let s=r.filter(i=>i.id!==e);return this.saveOffers(s),o({success:!0,message:"Offer deleted successfully"})}catch{return o({success:!1,error:"Failed to delete offer"})}}toggleOfferStatus(e){let r=this.offersSubject.value,t=r.findIndex(n=>n.id===e);if(t===-1)return o({success:!1,error:"Offer not found"});let s=l(f({},r[t]),{isActive:!r[t].isActive,updatedAt:new Date}),i=[...r];return i[t]=s,this.saveOffers(i),o({success:!0,data:s,message:`Offer ${s.isActive?"activated":"deactivated"} successfully`})}trackClick(e){let r=this.offersSubject.value,t=r.findIndex(n=>n.id===e);if(t===-1)return o({success:!1,error:"Offer not found"});let s=l(f({},r[t]),{clickCount:(r[t].clickCount||0)+1,updatedAt:new Date}),i=[...r];return i[t]=s,this.saveOffers(i),o({success:!0,message:"Click tracked successfully"})}getOfferStats(){return this.offers$.pipe(d(e=>{let r={};return e.forEach(t=>{t.isActive&&(r[t.categoryId]=(r[t.categoryId]||0)+1)}),{totalOffers:e.length,activeOffers:e.filter(t=>t.isActive).length,totalClicks:e.reduce((t,s)=>t+(s.clickCount||0),0),offersByCategory:r}}))}searchOffers(e,r=10){return this.offers$.pipe(d(t=>{if(!e.trim())return[];let s=e.toLowerCase();return t.filter(i=>i.isActive&&(i.title.toLowerCase().includes(s)||i.description.toLowerCase().includes(s)||i.referralCode&&i.referralCode.toLowerCase().includes(s))).slice(0,r)}))}bulkUpdateOffers(e,r){try{let s=[...this.offersSubject.value],i=[];return e.forEach(n=>{let a=s.findIndex(c=>c.id===n);a!==-1&&(s[a]=l(f(f({},s[a]),r),{id:n,updatedAt:new Date}),i.push(s[a]))}),i.length===0?o({success:!1,error:"No offers found to update"}):(this.saveOffers(s),o({success:!0,data:i,message:`${i.length} offers updated successfully`}))}catch{return o({success:!1,error:"Failed to bulk update offers"})}}generateId(){return"offer_"+Date.now().toString(36)+Math.random().toString(36).substr(2)}static \u0275fac=function(r){return new(r||p)(O(h))};static \u0275prov=y({token:p,factory:p.\u0275fac,providedIn:"root"})};export{v as a,h as b,b as c};
